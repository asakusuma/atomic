(function(t,e,undefined){function r(){l={exports:{}},c=l.exports,f={title:"Atomic CommonJS Harness"}}function i(){require=undefined,l=undefined,c=undefined,f=undefined}function n(t,e){return t.className.match(RegExp("(?:^|\\s)"+e.replace(/[^A-Z0-9\-\_]/gi,"-")+"(?!\\S)"))}function s(t){return"[object Array]"===Object.prototype.toString.call(t)}function o(t,e,r){var i,n,o,a=s(t)?"array":"object",u={},l={},c=function(t,e){return t&&e?c._.set(t,e):t?u[t]:u};if(c.toString=function(){var e,r,i=[];if("object"===a)for(e in t)t.hasOwnProperty(e)&&i.push(e+" ("+(u[e]?"R":"?")+"): "+t[e]);else for(r=0,o=t.length;o>r;r++)i.push("["+r+"] ("+(u[t[r]]?"R":"?")+"): "+t[r]);return i.join("\n")},c._={raw:function(){return t},exists:function(e){if("array"===a){for(var r=0,i=t.length;i>r;r++)if(t[r]===e)return!0;return!1}for(var n in t)if(t.hasOwnProperty(n)&&n===e)return!0;return!1},add:function(){"array"===a?l[arguments[0]]||(l[arguments[0]]=1,t.push(arguments[0]),c._.set(arguments[0],null)):(t[arguments[0]]=arguments[1],e&&(c[arguments[0]]=arguments[0]),r&&(u[arguments[0]]=arguments[0]))},set:function(t,e){u[t]=e}},"object"===a)for(i in t)t.hasOwnProperty(i)&&(c._.set(i,null),e&&(c[i]=i),r&&(u[i]=i));else for(n=0,o=t.length;o>n;n++)c._.set(t[n],null);return c}function a(){return u._.Bluebird}function s(t){return"[object Array]"===Object.prototype.toString.call(t)}function s(t){return"[object Array]"===Object.prototype.toString.call(t)}if(!t.Atomic){var u=function(){u.define.apply(u,arguments)};u.CONSTANTS={},u.Events={},u._={Fiber:null,EventEmitter:null,requires:{},modules:{}},u.loader={init:function(){},register:function(t,e){u._.modules[t]=e},load:function(t){for(var e=[],r=0,i=t.length;i>r;r++){if(!u._.modules[t[r]])throw Error("Module ID is not defined: "+t[r]);e.push(u._.modules[t[r]])}return e}};var l,c,f,require=null,define=null,h=null;try{h=e()}catch(p){}var _,d,v,y,m,g;u.config=t.ATOMIC_CONFIG||{},u.augment=function(t,e){if("[object Array]"===Object.prototype.toString.call(t))t=t.concat(e);else for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},u.describe=function(e,r){function i(i){var s=new i,o=[],a={};a.component=e,a.name=s.name,a.depends=s.depends._.raw(),a.events=s.events._.raw(),a.states=s.states._.raw(),o=[e+": "+s.name,"=====","BEM id: "+s.BEM(),"dependencies: "+s.depends._.raw().join(", "),"","ELEMENTS",""+s.elements,"","EVENTS",""+s.events,"","STATES",""+s.states],r&&t.console&&"function"==typeof t.console.log&&t.console.log(o.join("\n")),n.fulfill(a)}r===undefined&&(r=!0);var n=u.deferred();if("string"==typeof e)u.load([e]).then(u.expand(function(t){i(t)},u.e)).then(null,u.e);else if("function"==typeof e){var s=new e;i(s)}else i(e);return n.promise},u.define=function(t,e,r){if("string"!=typeof t)throw Error("you must specify an ID if you are not using a module loader system");"[object Array]"!==Object.prototype.toString.call(e)&&(r=e,e=[]);for(var i,require=function(t){if(window.console&&window.console.warn&&window.console.warn("using runtime require() is dangerous without a module loader"),!u._.modules[t])throw Error("Module not loaded: "+t);return u._.modules[t]},n={exports:{}},s=[],o=0,a=e.length;a>o;o++)if("require"!==e[o])if("module"!==e[o])if("exports"!==e[o]){if(!u._.modules[e[o]])throw Error("Module not loaded: "+e[o]);s.push(u._.modules[e[o]])}else s.push(n.exports);else s.push(n);else s.push(require);"function"==typeof r?(i=r.apply(r,s),u._.modules[t]=i?i:n.exports):u._.modules[t]=r};var d={};d=d,u.augment(u._.CONSTANTS,d),r(),function(t){function e(t,e){var r;for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}function Fiber(){}var r=!1,i=Array.prototype,n=t.Fiber;Fiber.extend=function(t){function i(){r||(this.init.apply(this,arguments),this.init=void 0)}var n,s=this.prototype,o=t(s);return r=!0,n=i.prototype=new this,r=!1,n.init=function(){"function"==typeof s.init&&s.init.apply(this,arguments)},e(o,n),n.constructor=i,i.__base__=s,i.extend=Fiber.extend,i},Fiber.proxy=function(t,e){var r,i,n={};1===arguments.length&&(e=t,t=e.constructor.__base__),i=function(r){return function(){return t[r].apply(e,arguments)}};for(r in t)t.hasOwnProperty(r)&&"function"==typeof t[r]&&(n[r]=i(r));return n},Fiber.decorate=function(t){var r,n=t.constructor.__base__,s=i.slice.call(arguments,1),o=s.length;for(r=0;o>r;r++)e(s[r].call(t,n),t)},Fiber.mixin=function(t){var r,n=t.__base__,s=i.slice.call(arguments,1),o=s.length;for(r=0;o>r;r++)e(s[r](n),t.prototype)},Fiber.noConflict=function(){return t.Fiber=n,Fiber},l!==undefined?"function"==typeof l.setExports?l.setExports(Fiber):l.exports&&(l.exports=Fiber):t.Fiber=Fiber}(this),u._.Fiber=l.exports,i(),r(),!function(t){function e(){this._events={},this._conf&&r.call(this,this._conf)}function r(t){t&&(this._conf=t,t.delimiter&&(this.delimiter=t.delimiter),t.maxListeners&&(this._events.maxListeners=t.maxListeners),t.wildcard&&(this.wildcard=t.wildcard),t.newListener&&(this.newListener=t.newListener),this.wildcard&&(this.listenerTree={}))}function i(t){this._events={},this.newListener=!1,r.call(this,t)}function n(t,e,r,i){if(!r)return[];var s,o,a,u,l,c,f,h=[],p=e.length,_=e[i],d=e[i+1];if(i===p&&r._listeners){if("function"==typeof r._listeners)return t&&t.push(r._listeners),[r];for(s=0,o=r._listeners.length;o>s;s++)t&&t.push(r._listeners[s]);return[r]}if("*"===_||"**"===_||r[_]){if("*"===_){for(a in r)"_listeners"!==a&&r.hasOwnProperty(a)&&(h=h.concat(n(t,e,r[a],i+1)));return h}if("**"===_){f=i+1===p||i+2===p&&"*"===d,f&&r._listeners&&(h=h.concat(n(t,e,r,p)));for(a in r)"_listeners"!==a&&r.hasOwnProperty(a)&&("*"===a||"**"===a?(r[a]._listeners&&!f&&(h=h.concat(n(t,e,r[a],p))),h=h.concat(n(t,e,r[a],i))):h=a===d?h.concat(n(t,e,r[a],i+2)):h.concat(n(t,e,r[a],i)));return h}h=h.concat(n(t,e,r[_],i+1))}if(u=r["*"],u&&n(t,e,u,i+1),l=r["**"])if(p>i){l._listeners&&n(t,e,l,p);for(a in l)"_listeners"!==a&&l.hasOwnProperty(a)&&(a===d?n(t,e,l[a],i+2):a===_?n(t,e,l[a],i+1):(c={},c[a]=l[a],n(t,e,{"**":c},i+1)))}else l._listeners?n(t,e,l,p):l["*"]&&l["*"]._listeners&&n(t,e,l["*"],p);return h}function s(t,e){t="string"==typeof t?t.split(this.delimiter):t.slice();for(var r=0,i=t.length;i>r+1;r++)if("**"===t[r]&&"**"===t[r+1])return;for(var n=this.listenerTree,s=t.shift();s;){if(n[s]||(n[s]={}),n=n[s],0===t.length){if(n._listeners){if("function"==typeof n._listeners)n._listeners=[n._listeners,e];else if(o(n._listeners)&&(n._listeners.push(e),!n._listeners.warned)){var u=a;this._events.maxListeners!==undefined&&(u=this._events.maxListeners),u>0&&n._listeners.length>u&&(n._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",n._listeners.length),console.trace())}}else n._listeners=e;return!0}s=t.shift()}return!0}var o=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},a=10;i.prototype.delimiter=".",i.prototype.setMaxListeners=function(t){this._events||e.call(this),this._events.maxListeners=t,this._conf||(this._conf={}),this._conf.maxListeners=t},i.prototype.event="",i.prototype.once=function(t,e){return this.many(t,1,e),this},i.prototype.many=function(t,e,r){function i(){0===--e&&n.off(t,i),r.apply(this,arguments)}var n=this;if("function"!=typeof r)throw Error("many only accepts instances of Function");return i._origin=r,this.on(t,i),n},i.prototype.emit=function(){this._events||e.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var r=arguments.length,i=Array(r-1),s=1;r>s;s++)i[s-1]=arguments[s];for(s=0,r=this._all.length;r>s;s++)this.event=t,this._all[s].apply(this,i)}if("error"===t&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:Error("Uncaught, unspecified 'error' event.");var o;if(this.wildcard){o=[];var a="string"==typeof t?t.split(this.delimiter):t.slice();n.call(this,o,a,this.listenerTree,0)}else o=this._events[t];if("function"==typeof o){if(this.event=t,1===arguments.length)o.call(this);else if(arguments.length>1)switch(arguments.length){case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:for(var r=arguments.length,i=Array(r-1),s=1;r>s;s++)i[s-1]=arguments[s];o.apply(this,i)}return!0}if(o){for(var r=arguments.length,i=Array(r-1),s=1;r>s;s++)i[s-1]=arguments[s];for(var u=o.slice(),s=0,r=u.length;r>s;s++)this.event=t,u[s].apply(this,i);return u.length>0||this._all}return this._all},i.prototype.on=function(t,r){if("function"==typeof t)return this.onAny(t),this;if("function"!=typeof r)throw Error("on only accepts instances of Function");if(this._events||e.call(this),this.emit("newListener",t,r),this.wildcard)return s.call(this,t,r),this;if(this._events[t]){if("function"==typeof this._events[t])this._events[t]=[this._events[t],r];else if(o(this._events[t])&&(this._events[t].push(r),!this._events[t].warned)){var i=a;this._events.maxListeners!==undefined&&(i=this._events.maxListeners),i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}}else this._events[t]=r;return this},i.prototype.onAny=function(t){if(this._all||(this._all=[]),"function"!=typeof t)throw Error("onAny only accepts instances of Function");return this._all.push(t),this},i.prototype.addListener=i.prototype.on,i.prototype.off=function(t,e){if("function"!=typeof e)throw Error("removeListener only takes instances of Function");var r,i=[];if(this.wildcard){var s="string"==typeof t?t.split(this.delimiter):t.slice();i=n.call(this,null,s,this.listenerTree,0)}else{if(!this._events[t])return this;r=this._events[t],i.push({_listeners:r})}for(var a=0;i.length>a;a++){var u=i[a];if(r=u._listeners,o(r)){for(var l=-1,c=0,f=r.length;f>c;c++)if(r[c]===e||r[c].listener&&r[c].listener===e||r[c]._origin&&r[c]._origin===e){l=c;break}if(0>l)continue;return this.wildcard?u._listeners.splice(l,1):this._events[t].splice(l,1),0===r.length&&(this.wildcard?delete u._listeners:delete this._events[t]),this}(r===e||r.listener&&r.listener===e||r._origin&&r._origin===e)&&(this.wildcard?delete u._listeners:delete this._events[t])}return this},i.prototype.offAny=function(t){var e,r=0,i=0;if(t&&this._all&&this._all.length>0){for(e=this._all,r=0,i=e.length;i>r;r++)if(t===e[r])return e.splice(r,1),this}else this._all=[];return this},i.prototype.removeListener=i.prototype.off,i.prototype.removeAllListeners=function(t){if(0===arguments.length)return!this._events||e.call(this),this;if(this.wildcard)for(var r="string"==typeof t?t.split(this.delimiter):t.slice(),i=n.call(this,null,r,this.listenerTree,0),s=0;i.length>s;s++){var o=i[s];o._listeners=null}else{if(!this._events[t])return this;this._events[t]=null}return this},i.prototype.listeners=function(t){if(this.wildcard){var r=[],i="string"==typeof t?t.split(this.delimiter):t.slice();return n.call(this,r,i,this.listenerTree,0),r}return this._events||e.call(this),this._events[t]||(this._events[t]=[]),o(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},i.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return i}):t.EventEmitter2=i}(f!==undefined&&f.title!==undefined&&c!==undefined?c:window),u._.EventEmitter=l.exports.EventEmitter2,i(),r(),function(t){"object"==typeof c?l.exports=t():"function"==typeof define&&define.amd?define(t):"undefined"!=typeof window?window.Promise=t():"undefined"!=typeof global?global.Promise=t():"undefined"!=typeof self&&(self.Promise=t())}(function(){return function t(e,r,i){function n(o,a){if(!r[o]){if(!e[o]){var u="function"==typeof require&&require;if(!a&&u)return u(o,!0);if(s)return s(o,!0);throw Error("Cannot find module '"+o+"'")}var l=r[o]={exports:{}};e[o][0].call(l.exports,function(t){var r=e[o][1][t];return n(r?r:t)},l,l.exports,t,e,r,i)}return r[o].exports}for(var s="function"==typeof require&&require,o=0;i.length>o;o++)n(i[o]);return n}({1:[function(require,t){"use strict";t.exports=function(t,e,r){function i(t,r,i){var s=e(t,n,i,r===!0?t._boundTo:void 0);return s.setHowMany(1),s.setUnwrap(),s.promise()}var n=require("./some_promise_array.js")(r);t.any=function(e){return i(e,!1,t.any)},t.prototype.any=function(){return i(this,!0,this.any)}}},{"./some_promise_array.js":34}],2:[function(require,t){"use strict";t.exports=function(){var t=function(){function t(t){this.constructor$(t),this.message=t,this.name="AssertionError"}return t.prototype=Error(),t.prototype.constructor=t,t.prototype.constructor$=Error,t}();return function e(r,i){if(r!==!0){var n=new t(i);throw Error.captureStackTrace&&Error.captureStackTrace(n,e),console&&console.error&&console.error(n.stack+""),n}}}()},{}],3:[function(require,t){"use strict";function e(){this._isTickUsed=!1,this._length=0,this._lateBuffer=new i,this._functionBuffer=new i(75e3);var t=this;this.consumeFunctionBuffer=function(){t._consumeFunctionBuffer()}}require("./assert.js");var r=require("./schedule.js"),i=require("./queue.js"),n=require("./util.js").errorObj,s=require("./util.js").tryCatch1;e.prototype.haveItemsQueued=function(){return this._length>0},e.prototype.invokeLater=function(t,e,r){this._lateBuffer.push(t,e,r),this._queueTick()},e.prototype.invoke=function(t,e,r){var i=this._functionBuffer;i.push(t,e,r),this._length=i.length(),this._queueTick()},e.prototype._consumeFunctionBuffer=function(){for(var t=this._functionBuffer;t.length()>0;){var e=t.shift(),r=t.shift(),i=t.shift();e.call(r,i)}this._reset(),this._consumeLateBuffer()},e.prototype._consumeLateBuffer=function(){for(var t=this._lateBuffer;t.length()>0;){var e=t.shift(),r=t.shift(),i=t.shift(),o=s(e,r,i);if(o===n)throw this._queueTick(),o.e}},e.prototype._queueTick=function(){this._isTickUsed||(r(this.consumeFunctionBuffer),this._isTickUsed=!0)},e.prototype._reset=function(){this._isTickUsed=!1,this._length=0},t.exports=new e},{"./assert.js":2,"./queue.js":26,"./schedule.js":30,"./util.js":36}],4:[function(require,t){"use strict";var e=require("./promise.js")();t.exports=e},{"./promise.js":18}],5:[function(require,t){"use strict";t.exports=function(t){function e(t){var e="string"==typeof this?this:""+this;return t[e]}t.prototype.call=function(t){for(var e=arguments.length,r=Array(e-1),i=1;e>i;++i)r[i-1]=arguments[i];return this._then(function(e){return e[t].apply(e,r)},void 0,void 0,void 0,void 0,this.call)},t.prototype.get=function(t){return this._then(e,void 0,void 0,t,void 0,this.get)}}},{}],6:[function(require,t){"use strict";t.exports=function(t){var e=require("./errors.js"),r=require("./async.js"),i=e.CancellationError;t.prototype.cancel=function(){if(!this.isCancellable())return this;for(var t=this;t._cancellationParent!==void 0;)t=t._cancellationParent;if(t===this){var e=new i;this._attachExtraTrace(e),this._reject(e)}else r.invoke(t.cancel,t,void 0);return this},t.prototype.uncancellable=function(){var e=new t;return e._setTrace(this.uncancellable,this),e._unsetCancellable(),e._assumeStateOf(this,!0),e._boundTo=this._boundTo,e},t.prototype.fork=function(t,e,r){var i=this._then(t,e,r,void 0,void 0,this.fork);return i._cancellationParent=void 0,i}}},{"./async.js":3,"./errors.js":10}],7:[function(require,t){"use strict";t.exports=function(){function t(t,e){this.captureStackTrace(t,e)}require("./assert.js");var e=require("./util.js").inherits,r=RegExp("\\b(?:Promise(?:Array|Spawn)?\\$_\\w+|tryCatch(?:1|2|Apply)|setTimeout|CatchFilter\\$_\\w+|makeNodePromisified|processImmediate|nextTick|Async\\$\\w+)\\b"),i=null,n=null,s=!1;e(t,Error),t.prototype.captureStackTrace=function(t,e){o(this,t,e)},t.possiblyUnhandledRejection=function(t){if("object"==typeof console){var e=t.stack,r="Possibly unhandled "+n(e,t);"function"==typeof console.error||"object"==typeof console.error?console.error(r):("function"==typeof console.log||"object"==typeof console.error)&&console.log(r)}},s="CapturedTrace$captureStackTrace"!==t.prototype.captureStackTrace.name,t.combine=function(t,e){for(var n=t.length-1,s=e.length-1;s>=0;--s){var o=e[s];if(t[n]!==o)break;t.pop(),n--}t.push("From previous event:");for(var a=t.concat(e),u=[],s=0,l=a.length;l>s;++s)r.test(a[s])||s>0&&!i.test(a[s])&&"From previous event:"!==a[s]||u.push(a[s]);return u},t.isSupported=function(){return"function"==typeof o};var o=function a(){function t(t){var e=41;return e>t.length?t:t.substr(0,e-3)+"..."}function e(e){var r=""+e,i=/\[object [a-zA-Z0-9$_]+\]/;if(i.test(r))try{var n=JSON.stringify(e);r=n}catch(s){}return"(<"+t(r)+">, no stack trace)"}if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){i=/^\s*at\s*/,n=function(t,r){return"string"==typeof t?t:r.name!==void 0&&r.message!==void 0?r.name+". "+r.message:e(r)};var r=Error.captureStackTrace;return function(t,e,i){var n=-1;i||(n=Error.stackTraceLimit,Error.stackTraceLimit=Math.max(1,0|Math.min(1e4,n)/3)),r(t,e),i||(Error.stackTraceLimit=n)}}var o=Error();if(!s&&"string"==typeof o.stack&&"function"==typeof"".startsWith&&o.stack.startsWith("stackDetection@")&&"stackDetection"===a.name){Object.defineProperty(Error,"stackTraceLimit",{writable:!0,enumerable:!1,configurable:!1,value:25}),i=/@/;var u=/[@\n]/;return n=function(t,r){return"string"==typeof t?r.name+". "+r.message+"\n"+t:r.name!==void 0&&r.message!==void 0?r.name+". "+r.message:e(r)},function r(t,e){var r,i=e.name,n=Error().stack,s=n.split(u),o=s.length;for(r=0;o>r&&s[r]!==i;r+=2);s=s.slice(r+2),o=s.length-2;var a="";for(r=0;o>r;r+=2)a+=s[r],a+="@",a+=s[r+1],a+="\n";t.stack=a}}return n=function(t,r){return"string"==typeof t?t:"object"!=typeof r&&"function"!=typeof r||r.name===void 0||r.message===void 0?e(r):r.name+". "+r.message},null}();return t}},{"./assert.js":2,"./util.js":36}],8:[function(require,t){"use strict";function e(t,e,r){this._instances=t,this._callback=e,this._promise=r}function r(t,e){var r={},i=s(t,r,e);if(i===o)return i;var n=Object.keys(r);return n.length?(o.e=new TypeError("Catch filter must inherit from Error or be a simple predicate function"),o):i}var i=require("./errors.js").ensureNotHandled,n=require("./util.js"),s=n.tryCatch1,o=n.errorObj;e.prototype.doFilter=function(t){for(var e=this._callback,n=0,a=this._instances.length;a>n;++n){var u=this._instances[n],l=u===Error||null!=u&&u.prototype instanceof Error;if(l&&t instanceof u){var c=s(e,this._promise._boundTo,t);if(c===o)throw c.e;return c}if("function"==typeof u&&!l){var f=r(u,t);if(f===o){this._promise._attachExtraTrace(o.e),t=o.e;break}if(f){var c=s(e,this._promise._boundTo,t);if(c===o)throw c.e;return c}}}throw i(t),t},t.exports=e},{"./errors.js":10,"./util.js":36}],9:[function(require,t){"use strict";t.exports=function(t){function e(){this.errorObj=a,this.__id__=0,this.treshold=1e3,this.thenableCache=Array(this.treshold),this.promiseCache=Array(this.treshold),this._compactQueued=!1}function r(e,r,s){if(null!=r.promise)return r.promise;var o=t.pending(s),u=r.ref;if(u===a)return o.reject(u.e),o.promise;f.addCache(e,o.promise);var c=!1,h=l(u,e,function p(t){if(!c){c=!0,n.invoke(f.deleteCache,f,e);var r=i(t);r===t?o.fulfill(t):t===e?o.promise._resolveFulfill(t):r._then(o.fulfill,o.reject,void 0,o,void 0,p)}},function p(t){c||(c=!0,n.invoke(f.deleteCache,f,e),o.reject(t))});return h!==a||c||(o.reject(h.e),n.invoke(f.deleteCache,f,e)),o.promise}function i(e,n){if(u(e)){if(e instanceof t)return e;var s={ref:null,promise:null};if(f.is(e,s))return n="function"==typeof n?n:i,r(e,s,n)}return e}require("./assert.js");var n=require("./async.js"),s=require("./util.js"),o=s.isPrimitive,a=s.errorObj,u=s.isObject,l=s.tryCatch2;e.prototype.couldBe=function(t){if(o(t))return!1;var e=t.__id_$thenable__;return"number"==typeof e&&this.thenableCache[e]!==void 0?!0:"then"in t},e.prototype.is=function(t,e){var r=t.__id_$thenable__;return"number"==typeof r&&this.thenableCache[r]!==void 0?(e.ref=this.thenableCache[r],e.promise=this.promiseCache[r],!0):this._thenableSlowCase(t,e)},e.prototype.addCache=function(t,e){var r=this.__id__;this.__id__=r+1;var i=this._descriptor(r);Object.defineProperty(t,"__id_$thenable__",i),this.thenableCache[r]=t,this.promiseCache[r]=e,this.thenableCache.length>this.treshold&&!this._compactQueued&&(this._compactQueued=!0,n.invokeLater(this._compactCache,this,void 0))},e.prototype.deleteCache=function(t){var e=t.__id_$thenable__;-1!==e&&(this.thenableCache[e]=void 0,this.promiseCache[e]=void 0,t.__id_$thenable__=-1)};var c={value:0,enumerable:!1,writable:!0,configurable:!0};e.prototype._descriptor=function(t){return c.value=t,c},e.prototype._compactCache=function(){for(var t=this.thenableCache,e=this.promiseCache,r=0,i=0,n=0,s=t.length;s>n;++n){var o=t[n];o===void 0?r++:(e[i]=e[n],o.__id_$thenable__=i,t[i++]=o)}var a=t.length-r;if(a===this.__id__)this.treshold*=2;else for(var n=a,s=t.length;s>n;++n)e[i]=t[n]=void 0;this.__id__=a,this._compactQueued=!1},e.prototype._thenableSlowCase=function(t,e){try{var r=t.then;return"function"==typeof r?(e.ref=r,!0):!1}catch(i){return this.errorObj.e=i,e.ref=this.errorObj,!0}};var f=new e(a);t._couldBeThenable=function(t){return f.couldBe(t)},t.prototype._resolveThenable=function(e,r){if(null!=r.promise)return this._assumeStateOf(r.promise,!0),undefined;if(r.ref===a)this._attachExtraTrace(r.ref.e),n.invoke(this._reject,this,r.ref.e);else{f.addCache(e,this);var s=r.ref,o=e,u=this,c={},h=!1,p=function p(r){if(!h||this===c){h=!0;var s=u._fulfill,a=i(r);if(a!==r||a instanceof t&&a.isPending())return r===e?(n.invoke(s,u,r),n.invoke(f.deleteCache,f,o)):a._then(p,_,void 0,c,void 0,p),undefined;if(a instanceof t){var s=a.isFulfilled()?u._fulfill:u._reject;if(r=r._resolvedValue,a=i(r),a!==r||a instanceof t&&a!==r)return a._then(p,_,void 0,c,void 0,p),undefined}n.invoke(s,u,r),n.invoke(f.deleteCache,f,o)}},_=function _(r){if(!h||this===c){var s=u._reject;h=!0;var a=i(r);if(a!==r||a instanceof t&&a.isPending())return r===e?(n.invoke(s,u,r),n.invoke(f.deleteCache,f,o)):a._then(p,_,void 0,c,void 0,p),undefined;if(a instanceof t){var s=a.isFulfilled()?u._fulfill:u._reject;if(r=r._resolvedValue,a=i(r),a!==r||a instanceof t&&a.isPending())return a._then(p,_,void 0,c,void 0,p),undefined}n.invoke(s,u,r),n.invoke(f.deleteCache,f,o)}},d=l(s,e,p,_);d!==a||h||(this._attachExtraTrace(d.e),n.invoke(this._reject,this,d.e),n.invoke(f.deleteCache,f,e))}},t.prototype._tryThenable=function(t){var e;return f.is(t,e={ref:null,promise:null})?(this._resolveThenable(t,e),!0):!1},t._cast=i}},{"./assert.js":2,"./async.js":3,"./util.js":36}],10:[function(require,t){"use strict";function e(t){return(1&t)>0}function r(t){return(2&t)>0}function i(t){return 1|t}function n(t){return 2|t}function s(t){return-3&t}function o(t){var e;v(t)&&(e=t.__promiseHandled__)!==void 0&&(t.__promiseHandled__=s(e))}function a(t){try{return y(t,"__promiseHandled__",0),!0}catch(e){return!1}}function u(t){return t instanceof m}function l(t){if(u(t)){var r=t.__promiseHandled__;return r===void 0?a(t):!e(r)}return!1}function c(t,e){function r(r){this.message="string"==typeof r?r:e,this.name=t,m.captureStackTrace&&m.captureStackTrace(this,this.constructor)}return d(r,m),r}function f(t){this.name="RejectionError",this.message=t,this.cause=t,t instanceof m?(this.message=t.message,this.stack=t.stack):m.captureStackTrace&&m.captureStackTrace(this,this.constructor)}var h=require("./global.js"),p=h.Object.freeze,_=require("./util.js"),d=_.inherits,v=_.isObject,y=_.notEnumerableProp,m=h.Error,g=h.TypeError;"function"!=typeof g&&(g=c("TypeError","type error"));var j=c("CancellationError","cancellation error"),b=c("TimeoutError","timeout error");d(f,m);var w="__BluebirdErrorTypes__",E=h[w];E||(E=p({CancellationError:j,TimeoutError:b,RejectionError:f}),y(h,w,E)),t.exports={Error:m,TypeError:g,CancellationError:E.CancellationError,RejectionError:E.RejectionError,TimeoutError:E.TimeoutError,attachDefaultState:a,ensureNotHandled:o,withHandledUnmarked:s,withHandledMarked:n,withStackAttached:i,isStackAttached:e,isHandled:r,canAttach:l}},{"./global.js":14,"./util.js":36}],11:[function(require,t){"use strict";t.exports=function(t){function e(e){var i=new r(e),n=t.rejected(i),s=n._peekContext();return null!=s&&s._attachExtraTrace(i),n}var r=require("./errors.js").TypeError;return e}},{"./errors.js":10}],12:[function(require,t){"use strict";t.exports=function(t,e,r,i){function n(t){var e=this,r=void 0;"function"!=typeof e&&(r=e.receiver,e=e.fn);var i=Array(t.length),n=0;if(r===void 0)for(var s=0,o=t.length;o>s;++s){var a=t[s];(a!==void 0||s in t)&&e(a,s,o)&&(i[n++]=a)}else for(var s=0,o=t.length;o>s;++s){var a=t[s];(a!==void 0||s in t)&&e.call(r,a,s,o)&&(i[n++]=a)}return i.length=n,i}function s(t,s,o,a){return"function"!=typeof s?i("fn is not a function"):(o===!0&&(s={fn:s,receiver:t._boundTo}),e(t,r,a,o===!0?t._boundTo:void 0).promise()._then(n,void 0,void 0,s,void 0,a))}require("./assert.js"),t.filter=function(e,r){return s(e,r,!1,t.filter)},t.prototype.filter=function(t){return s(this,t,!0,this.filter)}}},{"./assert.js":2}],13:[function(require,t){"use strict";t.exports=function(t,e){var r=require("./promise_spawn.js")(t),i=require("./errors.js"),n=i.TypeError;t.coroutine=function(t){if("function"!=typeof t)throw new n("generatorFunction must be a function");var e=r;return function i(){var r=t.apply(this,arguments),n=new e(void 0,void 0,i);return n._generator=r,n._next(void 0),n.promise()}},t.spawn=function(i){if("function"!=typeof i)return e("generatorFunction must be a function");var n=new r(i,this,t.spawn),s=n.promise();return n._run(t.spawn),s}}},{"./errors.js":10,"./promise_spawn.js":22}],14:[function(require,t){"use strict";t.exports=function(){return this!==undefined?this:f!==undefined&&"undefined"!=typeof global&&"string"==typeof f.execPath?global:"undefined"!=typeof window&&"undefined"!=typeof document&&"undefined"!=typeof navigator&&null!==navigator&&"string"==typeof navigator.appName?window:undefined}()},{}],15:[function(require,t){"use strict";t.exports=function(t,e,r,i){function n(i){var s=this,o=void 0;"function"!=typeof s&&(o=s.receiver,s=s.fn);var a=!1;if(o===void 0){for(var u=0,l=i.length;l>u;++u)if(i[u]!==void 0||u in i){var c=s(i[u],u,l);if(!a&&t.is(c)){if(c.isFulfilled()){i[u]=c._resolvedValue;continue}a=!0}i[u]=c}}else for(var u=0,l=i.length;l>u;++u)if(i[u]!==void 0||u in i){var c=s.call(o,i[u],u,l);if(!a&&t.is(c)){if(c.isFulfilled()){i[u]=c._resolvedValue;continue}a=!0}i[u]=c}return a?e(i,r,n,void 0).promise():i}function s(t,s,o,a){return"function"!=typeof s?i("fn is not a function"):(o===!0&&(s={fn:s,receiver:t._boundTo}),e(t,r,a,o===!0?t._boundTo:void 0).promise()._then(n,void 0,void 0,s,void 0,a))}require("./assert.js"),t.prototype.map=function(t){return s(this,t,!0,this.map)},t.map=function(e,r){return s(e,r,!1,t.map)}}},{"./assert.js":2}],16:[function(require,t){"use strict";t.exports=function(t){function e(t){throw t}function r(t,r){var i=this,n=o(i,r,null,t);n===u&&s.invokeLater(e,void 0,n.e)}function i(t,r){var i=this,n=a(i,r,t);n===u&&s.invokeLater(e,void 0,n.e)}var n=require("./util.js"),s=require("./async.js");require("./assert.js");var o=n.tryCatch2,a=n.tryCatch1,u=n.errorObj;t.prototype.nodeify=function(t){return"function"==typeof t&&this._then(r,i,void 0,t,this._isBound()?this._boundTo:null,this.nodeify),this}}},{"./assert.js":2,"./async.js":3,"./util.js":36}],17:[function(require,t){"use strict";t.exports=function(t){require("./assert.js");var e=require("./util.js"),r=require("./async.js"),i=e.tryCatch1,n=e.errorObj;t.prototype.progressed=function(t){return this._then(void 0,void 0,t,void 0,void 0,this.progressed)},t.prototype._progress=function(t){this._isFollowingOrFulfilledOrRejected()||this._resolveProgress(t)},t.prototype._progressAt=function(t){return 0===t?this._progress0:this[t+2-5]},t.prototype._resolveProgress=function(e){for(var s=this._length(),o=0;s>o;o+=5){var a=this._progressAt(o),u=this._promiseAt(o);if(t.is(u)){var l=e;a!==void 0?(this._pushContext(),l=i(a,this._receiverAt(o),e),this._popContext(),l===n?null!=l.e&&"StopProgressPropagation"===l.e.name?l.e.__promiseHandled__=2:(u._attachExtraTrace(l.e),r.invoke(u._progress,u,l.e)):t.is(l)?l._then(u._progress,null,null,u,void 0,this._progress):r.invoke(u._progress,u,l)):r.invoke(u._progress,u,l)}else a.call(this._receiverAt(o),e,u)}}}},{"./assert.js":2,"./async.js":3,"./util.js":36}],18:[function(require,t){"use strict";t.exports=function(){function t(t){return"object"!=typeof t?!1:t instanceof e}function e(t){this._bitField=67108864,this._fulfill0=void 0,this._reject0=void 0,this._progress0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolvedValue=void 0,this._cancellationParent=void 0,this._boundTo=void 0,L&&(this._traceParent=this._peekContext()),"function"==typeof t&&this._resolveResolver(t)}function r(t){throw t}function i(t,e){return this.isFulfilled()?t._then(function(){return e},r,void 0,this,void 0,i):t._then(function(){throw T(e),e},r,void 0,this,void 0,i)}function n(t,e,r){return s(t,c,r,e===!0?t._boundTo:void 0).promise()}function s(e,r,i,n){return t(e)||_(e)?new r(e,"function"==typeof i?i:s,n):new r([R("expecting an array or a promise")],i,n)}var o=require("./global.js");require("./assert.js");var a=require("./util.js"),u=require("./async.js"),l=require("./errors.js"),c=require("./promise_array.js")(e),f=require("./captured_trace.js")(),h=require("./catch_filter.js"),p=require("./promise_resolver.js"),_=a.isArray,d=a.notEnumerableProp,v=a.isObject,y=a.ensurePropertyExpansion,m=a.errorObj,g=a.tryCatch1,j=a.tryCatch2,b=a.tryCatchApply,w=l.TypeError,E=l.CancellationError,k=l.TimeoutError,A=l.RejectionError,T=l.ensureNotHandled,x=l.withHandledMarked,F=l.withStackAttached,C=l.isStackAttached,O=l.isHandled,P=l.canAttach,R=require("./errors_api_rejection")(e),S={};e.prototype.bind=function(t){var r=new e;return r._setTrace(this.bind,this),r._assumeStateOf(this,!0),r._setBoundTo(t),r},e.prototype.toString=function(){return"[object Promise]"},e.prototype.caught=e.prototype["catch"]=function(t){var e=arguments.length;if(e>1){var r,i=Array(e-1),n=0;for(r=0;e-1>r;++r){var s=arguments[r];if("function"!=typeof s){var o=new w("A catch filter must be an error constructor or a filter function");return this._attachExtraTrace(o),u.invoke(this._reject,this,o),undefined}i[n++]=s}i.length=n,t=arguments[r],this._resetTrace(this.caught);var a=new h(i,t,this);return this._then(void 0,a.doFilter,void 0,a,void 0,this.caught)}return this._then(void 0,t,void 0,void 0,void 0,this.caught)},e.prototype.lastly=e.prototype["finally"]=function(e){var r=function(r){var n=this._isBound()?e.call(this._boundTo):e();if(t(n))return i.call(this,n,r);if(this.isRejected())throw T(r),r;return r};return this._then(r,r,void 0,this,void 0,this.lastly)},e.prototype.then=function(t,e,r){return this._then(t,e,r,void 0,void 0,this.then)},e.prototype.done=function(t,e,r){var i=this._then(t,e,r,void 0,void 0,this.done);i._setIsFinal()},e.prototype.spread=function(t,e){return this._then(t,e,void 0,S,void 0,this.spread)},e.prototype.isFulfilled=function(){return(268435456&this._bitField)>0},e.prototype.isRejected=function(){return(134217728&this._bitField)>0},e.prototype.isPending=function(){return!this.isResolved()},e.prototype.isResolved=function(){return(402653184&this._bitField)>0},e.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},e.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this._resolvedValue,t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this._resolvedValue,t.isRejected=!0),t},e.prototype.all=function(){return n(this,!0,this.all)},e.is=t,e.all=function(t){return n(t,!1,e.all)},e.join=function(){for(var t=arguments.length,r=Array(t),i=0;t>i;++i)r[i]=arguments[i];return s(r,c,e.join,void 0).promise()},e.fulfilled=function(t,r){var i=new e;return i._setTrace("function"==typeof r?r:e.fulfilled,void 0),i._tryAssumeStateOf(t,!1)?i:(i._cleanValues(),i._setFulfilled(),i._resolvedValue=t,i)
},e.rejected=function(t){var r=new e;return r._setTrace(e.rejected,void 0),r._cleanValues(),r._setRejected(),r._resolvedValue=t,r},e["try"]=e.attempt=function(t,r,i){if("function"!=typeof t)return R("fn must be a function");var n=_(r)?b(t,r,i):g(t,i,r),s=new e;if(s._setTrace(e.attempt,void 0),n===m)return s._cleanValues(),s._setRejected(),s._resolvedValue=n.e,s;var o=e._cast(n);return o instanceof e?s._assumeStateOf(o,!0):(s._cleanValues(),s._setFulfilled(),s._resolvedValue=n),s},e.pending=function(t){var r=new e;return r._setTrace("function"==typeof t?t:e.pending,void 0),new p(r)},e.bind=function(t){var r=new e;return r._setTrace(e.bind,void 0),r._setFulfilled(),r._setBoundTo(t),r},e.cast=function(t,r){var i=e._cast(t,r);return i instanceof e?i:e.fulfilled(i,r)},e.onPossiblyUnhandledRejection=function(t){f.possiblyUnhandledRejection="function"==typeof t?t:void 0};var L=true;e.longStackTraces=function(){if(u.haveItemsQueued()&&L===!1)throw Error("Cannot enable long stack traces after promises have been created");L=!0},e.hasLongStackTraces=function(){return L},e.prototype._then=function(t,r,i,n,s,o){var a=s!==void 0,l=a?s:new e;if(L&&!a){var c=this._peekContext()===this._traceParent;l._traceParent=c?this._traceParent:this,l._setTrace("function"==typeof o?o:this._then,this)}a||(l._boundTo=this._boundTo);var f=this._addCallbacks(t,r,i,l,n);if(this.isResolved()?u.invoke(this._resolveLast,this,f):!a&&this.isCancellable()&&(l._cancellationParent=this),this._isDelegated()){this._unsetDelegated();var h=this._resolvedValue;this._tryThenable(h)||u.invoke(this._fulfill,this,h)}return l},e.prototype._length=function(){return 16777215&this._bitField},e.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},e.prototype._setLength=function(t){this._bitField=-16777216&this._bitField|16777215&t},e.prototype._cancellable=function(){return(67108864&this._bitField)>0},e.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},e.prototype._setRejected=function(){this._bitField=134217728|this._bitField},e.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},e.prototype._setDelegated=function(){this._bitField=-1073741824|this._bitField},e.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},e.prototype._isFinal=function(){return(33554432&this._bitField)>0},e.prototype._isDelegated=function(){return-1073741824===(-1073741824&this._bitField)},e.prototype._unsetDelegated=function(){this._bitField=1073741823&this._bitField},e.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},e.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},e.prototype._receiverAt=function(t){var e;return e=0===t?this._receiver0:this[t+4-5],this._isBound()&&e===void 0?this._boundTo:e},e.prototype._promiseAt=function(t){return 0===t?this._promise0:this[t+3-5]},e.prototype._fulfillAt=function(t){return 0===t?this._fulfill0:this[t+0-5]},e.prototype._rejectAt=function(t){return 0===t?this._reject0:this[t+1-5]},e.prototype._unsetAt=function(t){0===t?this._fulfill0=this._reject0=this._progress0=this._promise0=this._receiver0=void 0:this[t-5+0]=this[t-5+1]=this[t-5+2]=this[t-5+3]=this[t-5+4]=void 0},e.prototype._resolveResolver=function(t){this._setTrace(this._resolveResolver,void 0);var e=new p(this);this._pushContext();var r=j(t,this,function(t){e.fulfill(t)},function(t){e.reject(t)});this._popContext(),r===m&&e.reject(r.e)},e.prototype._addCallbacks=function(t,e,r,i,n){t="function"==typeof t?t:void 0,e="function"==typeof e?e:void 0,r="function"==typeof r?r:void 0;var s=this._length();return 0===s?(this._fulfill0=t,this._reject0=e,this._progress0=r,this._promise0=i,this._receiver0=n,this._setLength(s+5),s):(this[s-5+0]=t,this[s-5+1]=e,this[s-5+2]=r,this[s-5+3]=i,this[s-5+4]=n,this._setLength(s+5),s)},e.prototype._spreadSlowCase=function(t,e,r,i){e._assumeStateOf(s(r,c,this._spreadSlowCase,i).promise()._then(function(){return t.apply(i,arguments)},void 0,void 0,S,void 0,this._spreadSlowCase),!1)},e.prototype._setBoundTo=function(t){this._boundTo=t},e.prototype._isBound=function(){return this._boundTo!==void 0};var M=h.prototype.doFilter;e.prototype._resolvePromise=function(r,i,n,s){var o=this.isRejected();if(o&&"object"==typeof n&&null!==n){var a=n.__promiseHandled__;a===void 0?d(n,"__promiseHandled__",2):n.__promiseHandled__=x(a)}if(!t(s))return r.call(i,n,s);var l;if(o||i!==S)s._pushContext(),l=g(r,i,n);else{if(!_(n))return this._spreadSlowCase(r,s,n,this._boundTo),undefined;for(var c=0,f=n.length;f>c;++c)if(t(e._cast(n[c])))return this._spreadSlowCase(r,s,n,this._boundTo),undefined;s._pushContext(),l=b(r,n,this._boundTo)}if(s._popContext(),l===m)T(l.e),r!==M&&s._attachExtraTrace(l.e),u.invoke(s._reject,s,l.e);else if(l===s){var h=new w("Circular thenable chain");this._attachExtraTrace(h),u.invoke(s._reject,s,h)}else{if(s._tryAssumeStateOf(l,!0))return;if(e._couldBeThenable(l)){if(0===s._length())return s._resolvedValue=l,s._setDelegated(),undefined;if(s._tryThenable(l))return}u.invoke(s._fulfill,s,l)}},e.prototype._assumeStateOf=function(t,e){this._setFollowing(),t.isPending()?(t._cancellable()&&(this._cancellationParent=t),t._then(this._resolveFulfill,this._resolveReject,this._resolveProgress,this,void 0,this._tryAssumeStateOf)):t.isFulfilled()?e===!0?u.invoke(this._resolveFulfill,this,t._resolvedValue):this._resolveFulfill(t._resolvedValue):e===!0?u.invoke(this._resolveReject,this,t._resolvedValue):this._resolveReject(t._resolvedValue),L&&null==t._traceParent&&(t._traceParent=this)},e.prototype._tryAssumeStateOf=function(e,r){return!t(e)||this._isFollowingOrFulfilledOrRejected()?!1:(this._assumeStateOf(e,r),!0)},e.prototype._resetTrace=function(t){if(L){var e=this._peekContext(),r=e===void 0;this._trace=new f("function"==typeof t?t:this._resetTrace,r)}},e.prototype._setTrace=function(t,e){if(L){var r=this._peekContext(),i=r===void 0;this._trace=e!==void 0&&e._traceParent===r?e._trace:new f("function"==typeof t?t:this._setTrace,i)}return this},e.prototype._attachExtraTrace=function(t){if(L&&P(t)){var e=this,r=t.stack;r="string"==typeof r?r.split("\n"):[];for(var i=1;null!=e&&null!=e._trace;)r=f.combine(r,e._trace.stack.split("\n")),e=e._traceParent;var n=Error.stackTraceLimit+i,s=r.length;s>n&&(r.length=n),t.stack=i>=r.length?"(No stack trace)":r.join("\n"),t.__promiseHandled__=F(t.__promiseHandled__)}},e.prototype._notifyUnhandledRejection=function(t){O(t.__promiseHandled__)||(t.__promiseHandled__=x(t.__promiseHandled__),f.possiblyUnhandledRejection(t,this))},e.prototype._unhandledRejection=function(t){O(t.__promiseHandled__)||u.invokeLater(this._notifyUnhandledRejection,this,t)},e.prototype._cleanValues=function(){this._cancellationParent=void 0},e.prototype._fulfill=function(t){this._isFollowingOrFulfilledOrRejected()||this._resolveFulfill(t)},e.prototype._reject=function(t){this._isFollowingOrFulfilledOrRejected()||this._resolveReject(t)},e.prototype._doResolveAt=function(t){var e=this.isFulfilled()?this._fulfillAt(t):this._rejectAt(t),r=this._resolvedValue,i=this._receiverAt(t),n=this._promiseAt(t);this._unsetAt(t),this._resolvePromise(e,i,r,n)},e.prototype._resolveFulfill=function(t){this._cleanValues(),this._setFulfilled(),this._resolvedValue=t;var e=this._length();this._setLength(0);for(var r=0;e>r;r+=5)if(this._fulfillAt(r)!==void 0)u.invoke(this._doResolveAt,this,r);else{var i=this._promiseAt(r);this._unsetAt(r),u.invoke(i._fulfill,i,t)}},e.prototype._resolveLast=function(t){this._setLength(0);var e;if(e=this.isFulfilled()?this._fulfillAt(t):this._rejectAt(t),e!==void 0)u.invoke(this._doResolveAt,this,t);else{var r=this._promiseAt(t),i=this._resolvedValue;this._unsetAt(t),this.isFulfilled()?u.invoke(r._fulfill,r,i):u.invoke(r._reject,r,i)}},e.prototype._resolveReject=function(t){if(this._cleanValues(),this._setRejected(),this._resolvedValue=t,this._isFinal())return u.invokeLater(r,void 0,t),undefined;var e=this._length();this._setLength(0);for(var i=!1,n=0;e>n;n+=5)if(this._rejectAt(n)!==void 0)i=!0,u.invoke(this._doResolveAt,this,n);else{var s=this._promiseAt(n);this._unsetAt(n),i||(i=s._length()>0),u.invoke(s._reject,s,t)}if(!i&&f.possiblyUnhandledRejection!==void 0&&v(t)){var o=t.__promiseHandled__,a=t;if(o===void 0)a=y(t,"__promiseHandled__",0),o=0;else if(O(o))return;C(o)||this._attachExtraTrace(a),u.invoke(this._unhandledRejection,this,a)}};var V=[];e.prototype._peekContext=function(){var t=V.length-1;return t>=0?V[t]:void 0},e.prototype._pushContext=function(){L&&V.push(this)},e.prototype._popContext=function(){L&&V.pop()};var B=o.Promise;return e.noConflict=function(){return o.Promise===e&&(o.Promise=B),e},f.isSupported()||(e.longStackTraces=function(){},L=!1),e.CancellationError=E,e.TimeoutError=k,e.TypeError=w,e.RejectionError=A,require("./synchronous_inspection.js")(e),require("./any.js")(e,s,c),require("./race.js")(e,s,c),require("./call_get.js")(e),require("./filter.js")(e,s,c,R),require("./generators.js")(e,R),require("./map.js")(e,s,c,R),require("./nodeify.js")(e),require("./promisify.js")(e),require("./props.js")(e,c),require("./reduce.js")(e,s,c,R),require("./settle.js")(e,s,c),require("./some.js")(e,s,c,R),require("./progress.js")(e),require("./cancel.js")(e),require("./complex_thenables.js")(e),e.prototype=e.prototype,e}},{"./any.js":1,"./assert.js":2,"./async.js":3,"./call_get.js":5,"./cancel.js":6,"./captured_trace.js":7,"./catch_filter.js":8,"./complex_thenables.js":9,"./errors.js":10,"./errors_api_rejection":11,"./filter.js":12,"./generators.js":13,"./global.js":14,"./map.js":15,"./nodeify.js":16,"./progress.js":17,"./promise_array.js":19,"./promise_resolver.js":21,"./promisify.js":23,"./props.js":25,"./race.js":27,"./reduce.js":29,"./settle.js":31,"./some.js":33,"./synchronous_inspection.js":35,"./util.js":36}],19:[function(require,t){"use strict";t.exports=function(t){function e(t){switch(t){case 0:return void 0;case 1:return[];case 2:return{}}}function r(e,r,i){this._values=e,this._resolver=t.pending(r),i!==void 0&&this._resolver.promise._setBoundTo(i),this._length=0,this._totalResolved=0,this._init(void 0,1)}require("./assert.js");var i=require("./errors.js").ensureNotHandled,n=require("./util.js"),s=require("./async.js"),o={}.hasOwnProperty,a=n.isArray;return r.PropertiesPromiseArray=function(){},r.prototype.length=function(){return this._length},r.prototype.promise=function(){return this._resolver.promise},r.prototype._init=function(i,n){var u=this._values;if(t.is(u)){if(!u.isFulfilled())return u.isPending()?(u._then(this._init,this._reject,void 0,this,n,this.constructor),undefined):(this._reject(u._resolvedValue),undefined);if(u=u._resolvedValue,!a(u))return this._fulfill(e(n)),undefined;this._values=u}if(0===u.length)return this._fulfill(e(n)),undefined;var l,c=u.length,f=c;l=this instanceof r.PropertiesPromiseArray?this._values:Array(c);for(var h=!1,p=0;c>p;++p){var _=u[p];if(_!==void 0||o.call(u,p)){var d=t._cast(_);d instanceof t&&d.isPending()?d._then(this._promiseFulfilled,this._promiseRejected,this._promiseProgressed,this,p,this._scanDirectValues):h=!0,l[p]=d}else f--}if(0===f)return 1===n?this._fulfill(l):this._fulfill(e(n)),undefined;if(this._values=l,this._length=f,h){var v=f===c?this._scanDirectValues:this._scanDirectValuesHoled;s.invoke(v,this,c)}},r.prototype._resolvePromiseAt=function(e){var r=this._values[e];t.is(r)?r.isFulfilled()?this._promiseFulfilled(r._resolvedValue,e):r.isRejected()&&this._promiseRejected(r._resolvedValue,e):this._promiseFulfilled(r,e)},r.prototype._scanDirectValuesHoled=function(t){for(var e=0;t>e&&!this._isResolved();++e)o.call(this._values,e)&&this._resolvePromiseAt(e)},r.prototype._scanDirectValues=function(t){for(var e=0;t>e&&!this._isResolved();++e)this._resolvePromiseAt(e)},r.prototype._isResolved=function(){return null===this._values},r.prototype._fulfill=function(t){this._values=null,this._resolver.fulfill(t)},r.prototype._reject=function(t){i(t),this._values=null,this._resolver.reject(t)},r.prototype._promiseProgressed=function(t,e){this._isResolved()||this._resolver.progress({index:e,value:t})},r.prototype._promiseFulfilled=function(t,e){if(!this._isResolved()){this._values[e]=t;var r=++this._totalResolved;r>=this._length&&this._fulfill(this._values)}},r.prototype._promiseRejected=function(t){this._isResolved()||(this._totalResolved++,this._reject(t))},r}},{"./assert.js":2,"./async.js":3,"./errors.js":10,"./util.js":36}],20:[function(require,t){"use strict";function e(t){t!==void 0?(this._bitField=t._bitField,this._resolvedValue=t.isResolved()?t._resolvedValue:void 0):(this._bitField=0,this._resolvedValue=void 0)}var r=require("./errors.js").TypeError;e.prototype.isFulfilled=function(){return(268435456&this._bitField)>0},e.prototype.isRejected=function(){return(134217728&this._bitField)>0},e.prototype.isPending=function(){return 0===(402653184&this._bitField)},e.prototype.value=function(){if(!this.isFulfilled())throw new r("cannot get fulfillment value of a non-fulfilled promise");return this._resolvedValue},e.prototype.error=function(){if(!this.isRejected())throw new r("cannot get rejection reason of a non-rejected promise");return this._resolvedValue},t.exports=e},{"./errors.js":10}],21:[function(require,t){"use strict";function e(t){return t instanceof Error&&Object.getPrototypeOf(t)===Error.prototype}function r(t){return e(t)?new l(t):t}function i(t){function e(e,i){if(e)t.reject(r(o(e)));else if(arguments.length>2){for(var n=arguments.length,s=Array(n-1),a=1;n>a;++a)s[a-1]=arguments[a];t.fulfill(s)}else t.fulfill(i)}return e}var n,s=require("./util.js"),o=s.maybeWrapAsError,a=require("./errors.js"),u=a.TimeoutError,l=a.RejectionError,c=require("./async.js"),f=s.haveGetters;n=f?function n(t){this.promise=t}:function n(t){this.promise=t,this.asCallback=i(this)},f&&Object.defineProperty(n.prototype,"asCallback",{get:function(){return i(this)}}),n._nodebackForResolver=i,n.prototype.toString=function(){return"[object PromiseResolver]"},n.prototype.fulfill=function(t){this.promise._tryAssumeStateOf(t,!1)||c.invoke(this.promise._fulfill,this.promise,t)},n.prototype.reject=function(t){this.promise._attachExtraTrace(t),c.invoke(this.promise._reject,this.promise,t)},n.prototype.progress=function(t){c.invoke(this.promise._progress,this.promise,t)},n.prototype.cancel=function(){c.invoke(this.promise.cancel,this.promise,void 0)},n.prototype.timeout=function(){this.reject(new u("timeout"))},n.prototype.isResolved=function(){return this.promise.isResolved()},n.prototype.toJSON=function(){return this.promise.toJSON()},t.exports=n},{"./async.js":3,"./errors.js":10,"./util.js":36}],22:[function(require,t){"use strict";t.exports=function(t){function e(e,r,i){this._resolver=t.pending(i),this._generatorFunction=e,this._receiver=r,this._generator=void 0}var r=require("./errors.js"),i=r.TypeError,n=r.ensureNotHandled,s=require("./util.js"),o=s.isArray,a=s.errorObj,u=s.tryCatch1;return e.prototype.promise=function(){return this._resolver.promise},e.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},e.prototype._continue=function l(e){if(e===a)return this._generator=void 0,this._resolver.reject(e.e),undefined;var r=e.value;if(e.done===!0)this._generator=void 0,this._resolver.fulfill(r);else{var n=t._cast(r,l);if(!(n instanceof t)){if(!o(n))return this._throw(new i("A value was yielded that could not be treated as a promise")),undefined;n=t.all(n)}n._then(this._next,this._throw,void 0,this,null,void 0)}},e.prototype._throw=function(t){n(t),this.promise()._attachExtraTrace(t),this._continue(u(this._generator["throw"],this._generator,t))},e.prototype._next=function(t){this._continue(u(this._generator.next,this._generator,t))},e}},{"./errors.js":10,"./util.js":36}],23:[function(require,t){"use strict";t.exports=function(t){function e(e,r,i){function n(t){for(var i=Array(t),n=0,s=i.length;s>n;++n)i[n]="a"+(n+1);var a=t>0?",":"";return"string"==typeof e&&r===o?"this['"+e+"']("+i.join(",")+a+" fn);"+"break;":(r===void 0?"callback("+i.join(",")+a+" fn);":"callback.call("+(r===o?"this":"receiver")+", "+i.join(",")+a+" fn);")+"break;"}function s(){return"var args = new Array( len + 1 );var i = 0;for( var i = 0; i < len; ++i ) {    args[i] = arguments[i];}args[i] = fn;"}var a="string"==typeof i?i+"Async":"promisified";return Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForResolver","var ret = function "+a+'( a1, a2, a3, a4, a5 ) {"use strict";'+"var len = arguments.length;"+"var resolver = Promise.pending( "+a+" );"+"var fn = nodebackForResolver( resolver );"+"try{"+"switch( len ) {"+"case 1:"+n(1)+"case 2:"+n(2)+"case 3:"+n(3)+"case 0:"+n(0)+"case 4:"+n(4)+"case 5:"+n(5)+"default: "+s()+("string"==typeof e?"this['"+e+"'].apply(":"callback.apply(")+(r===o?"this":"receiver")+", args ); break;"+"}"+"}"+"catch(e){ "+"resolver.reject( maybeWrapAsError( e ) );"+"}"+"return resolver.promise;"+"}; ret.__isPromisified__ = true; return ret;")(t,e,r,f,h,l)}function r(e,r){function i(){var n=r;r===o&&(n=this),"string"==typeof e&&(e=n[e]);var s=t.pending(i),a=l(s);try{e.apply(n,f(arguments,a))}catch(u){s.reject(h(u))}return s.promise}return i.__isPromisified__=!0,i}function i(){}function n(t){return t.__isPromisified__===!0}function s(t,e,r){if(r){var s=0,a={};for(var u in t)if(!m.test(u)&&!y.call(t,u+"__beforePromisified__")&&"function"==typeof t[u]){var l=t[u];if(!n(l)){s++;var c=u+"__beforePromisified__",f=u+"Async";_(t,c,l),a[f]=v(c,o,u)}}if(s>0){for(var u in a)y.call(a,u)&&(t[u]=a[u]);i.prototype=t}return t}return v(t,e,void 0)}var o={},a=require("./util.js"),u=require("./errors.js"),l=require("./promise_resolver.js")._nodebackForResolver,c=u.RejectionError,f=a.withAppended,h=a.maybeWrapAsError,p=a.canEvaluate,_=a.notEnumerableProp,d=a.deprecated;require("./assert.js"),t.prototype.error=function(t){return this.caught(c,t)};var v=p?e:r,y={}.hasOwnProperty,m=RegExp("__beforePromisified__$");t.promisify=function(t,e){if("object"==typeof t&&null!==t)return d("Promise.promisify for promisifying entire objects is deprecated. Use Promise.promisifyAll instead."),s(t,e,!0);if("function"!=typeof t)throw new TypeError("callback must be a function");return n(t)?t:s(t,2>arguments.length?o:e,!1)},t.promisifyAll=function(t){if("function"!=typeof t&&"object"!=typeof t)throw new TypeError("Cannot promisify "+typeof t);return s(t,void 0,!0)}}},{"./assert.js":2,"./errors.js":10,"./promise_resolver.js":21,"./util.js":36}],24:[function(require,t){"use strict";t.exports=function(t,e){function r(t,e,r){for(var i=Object.keys(t),n=Array(i.length),s=0,o=n.length;o>s;++s)n[s]=t[i[s]];if(this.constructor$(n,e,r),!this._isResolved())for(var s=0,o=i.length;o>s;++s)n.push(i[s])}require("./assert.js");var i=require("./util.js"),n=i.inherits;return n(r,e),r.prototype._init=function(){this._init$(void 0,2)},r.prototype._promiseFulfilled=function(t,e){if(!this._isResolved()){this._values[e]=t;var r=++this._totalResolved;if(r>=this._length){for(var i={},n=this.length(),s=0,o=this.length();o>s;++s)i[this._values[s+n]]=this._values[s];this._fulfill(i)}}},r.prototype._promiseProgressed=function(t,e){this._isResolved()||this._resolver.progress({key:this._values[e+this.length()],value:t})},e.PropertiesPromiseArray=r,r}},{"./assert.js":2,"./util.js":36}],25:[function(require,t){"use strict";t.exports=function(t,e){function r(e,r,n){var o;return s(e)?o=t.fulfilled(e,n):t.is(e)?o=e._then(t.props,void 0,void 0,void 0,void 0,n):(o=new i(e,n,r===!0?e._boundTo:void 0).promise(),r=!1),r===!0&&(o._boundTo=e._boundTo),o}var i=require("./properties_promise_array.js")(t,e),n=require("./util.js"),s=n.isPrimitive;t.prototype.props=function(){return r(this,!0,this.props)},t.props=function(e){return r(e,!1,t.props)}}},{"./properties_promise_array.js":24,"./util.js":36}],26:[function(require,t){"use strict";function e(t,e,r,i,n){for(var s=0;n>s;++s)r[s+i]=t[s+e]}function r(t){return t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t+1}function i(t){return"number"!=typeof t?16:r(Math.min(Math.max(16,t),1073741824))}function n(t){this._capacity=i(t),this._length=0,this._front=0,this._makeCapacity()}require("./assert.js"),n.prototype._willBeOverCapacity=function(t){return t>this._capacity},n.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1);var r=this._front+e&this._capacity-1;this[r]=t,this._length=e+1},n.prototype.push=function(t,e,r){var i=this.length()+3;if(this._willBeOverCapacity(i))return this._pushOne(t),this._pushOne(e),this._pushOne(r),undefined;var n=this._front+i-3;this._checkCapacity(i);var s=this._capacity-1;this[n+0&s]=t,this[n+1&s]=e,this[n+2&s]=r,this._length=i},n.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},n.prototype.length=function(){return this._length},n.prototype._makeCapacity=function(){for(var t=this._capacity,e=0;t>e;++e)this[e]=void 0},n.prototype._checkCapacity=function(t){t>this._capacity&&this._resizeTo(this._capacity<<3)},n.prototype._resizeTo=function(t){var r=this._front,i=this._capacity,n=Array(i),s=this.length();if(e(this,0,n,0,i),this._capacity=t,this._makeCapacity(),this._front=0,i>=r+s)e(n,r,this,0,s);else{var o=s-(r+s&i-1);e(n,r,this,0,o),e(n,0,this,o,s-o)}},t.exports=n},{"./assert.js":2}],27:[function(require,t){"use strict";t.exports=function(t,e,r){function i(t,r,i){return e(t,n,i,r===!0?t._boundTo:void 0).promise()}var n=require("./race_promise_array.js")(t,r);t.race=function(e){return i(e,!1,t.race)},t.prototype.race=function(){return i(this,!0,this.race)}}},{"./race_promise_array.js":28}],28:[function(require,t){"use strict";t.exports=function(t,e){function r(t,e,r){this.constructor$(t,e,r)}var i=require("./util.js"),n=i.inherits;return n(r,e),r.prototype._init=function(){this._init$(void 0,0)},r.prototype._promiseFulfilled=function(t){this._isResolved()||this._fulfill(t)},r.prototype._promiseRejected=function(t){this._isResolved()||this._reject(t)},r}},{"./util.js":36}],29:[function(require,t){"use strict";t.exports=function(t,e,r,i){function n(t,e){var r=this,i=void 0;"function"!=typeof r&&(i=r.receiver,r=r.fn);var n=t.length,s=void 0,o=0;if(e!==void 0)s=e,o=0;else if(o=1,n>0)for(var a=0;n>a;++a)if(t[a]!==void 0||a in t){s=t[a],o=a+1;break}if(i===void 0)for(var a=o;n>a;++a)(t[a]!==void 0||a in t)&&(s=r(s,t[a],a,n));else for(var a=o;n>a;++a)(t[a]!==void 0||a in t)&&(s=r.call(i,s,t[a],a,n));return s}function s(t){var e=this.fn,r=this.initialValue;return n.call(e,t,r)}function o(t,e,r,i,n){return r._then(function s(r){return a(t,e,r,i,s)},void 0,void 0,void 0,void 0,n)}function a(a,u,l,c,f){if("function"!=typeof u)return i("fn is not a function");if(c===!0&&(u={fn:u,receiver:a._boundTo}),l!==void 0){if(t.is(l)){if(!l.isFulfilled())return o(a,u,l,c,f);l=l._resolvedValue}return e(a,r,f,c===!0?a._boundTo:void 0).promise()._then(s,void 0,void 0,{fn:u,initialValue:l},void 0,t.reduce)}return e(a,r,f,c===!0?a._boundTo:void 0).promise()._then(n,void 0,void 0,u,void 0,f)}require("./assert.js"),t.reduce=function(e,r,i){return a(e,r,i,!1,t.reduce)},t.prototype.reduce=function(t,e){return a(this,t,e,!0,this.reduce)}}},{"./assert.js":2}],30:[function(require,t){"use strict";var e=require("./global.js");require("./assert.js");var r;if(f!==undefined&&null!==f&&"function"==typeof f.cwd)r=e.setImmediate!==undefined?function(t){e.setImmediate(t)}:function(t){f.nextTick(t)};else if("function"!=typeof MutationObserver&&"function"!=typeof WebkitMutationObserver&&"function"!=typeof WebKitMutationObserver||"undefined"==typeof document||"function"!=typeof document.createElement)if("function"==typeof e.postMessage&&"function"!=typeof e.importScripts&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener){var i="bluebird_message_key_"+Math.random();r=function(){function t(t){if(t.source===e&&t.data===i){var n=r;r=void 0,n()}}var r=void 0;return e.addEventListener("message",t,!1),function t(t){r=t,e.postMessage(i,"*")}}()}else r="function"==typeof MessageChannel?function(){var t=void 0,e=new MessageChannel;return e.port1.onmessage=function(){var e=t;t=void 0,e()},function(r){t=r,e.port2.postMessage(null)}}():e.setTimeout?function(t){setTimeout(t,4)}:function(t){t()};else r=function(){var t=e.MutationObserver||e.WebkitMutationObserver||e.WebKitMutationObserver,r=document.createElement("div"),i=void 0,n=new t(function(){var t=i;i=void 0,t()}),s=!0;return n.observe(r,{attributes:!0,childList:!0,characterData:!0}),function(t){i=t,s=!s,r.setAttribute("class",s?"foo":"bar")}}();t.exports=r},{"./assert.js":2,"./global.js":14}],31:[function(require,t){"use strict";t.exports=function(t,e,r){function i(t,r,i){return e(t,n,i,r===!0?t._boundTo:void 0).promise()}var n=require("./settled_promise_array.js")(t,r);t.settle=function(e){return i(e,!1,t.settle)},t.prototype.settle=function(){return i(this,!0,this.settle)}}},{"./settled_promise_array.js":32}],32:[function(require,t){"use strict";t.exports=function(t,e){function r(t,e,r){this.constructor$(t,e,r)}require("./assert.js");var i=require("./promise_inspection.js"),n=require("./util.js"),s=n.inherits;return s(r,e),r.prototype._promiseResolved=function(t,e){this._values[t]=e;var r=++this._totalResolved;r>=this._length&&this._fulfill(this._values)},r.prototype._promiseFulfilled=function(t,e){if(!this._isResolved()){var r=new i;r._bitField=268435456,r._resolvedValue=t,this._promiseResolved(e,r)}},r.prototype._promiseRejected=function(t,e){if(!this._isResolved()){var r=new i;r._bitField=134217728,r._resolvedValue=t,this._promiseResolved(e,r)}},r}},{"./assert.js":2,"./promise_inspection.js":20,"./util.js":36}],33:[function(require,t){"use strict";t.exports=function(t,e,r,i){function n(t,r,n,o){if((0|r)!==r)return i("howMany must be an integer");var a=e(t,s,o,n===!0?t._boundTo:void 0);return a.setHowMany(r),a.promise()}var s=require("./some_promise_array.js")(r);require("./assert.js"),t.some=function(e,r){return n(e,r,!1,t.some)},t.prototype.some=function(t){return n(this,t,!0,this.some)}}},{"./assert.js":2,"./some_promise_array.js":34}],34:[function(require,t){"use strict";t.exports=function(t){function e(t,e,r){this.constructor$(t,e,r),this._howMany=0,this._unwrap=!1}var r=require("./util.js"),i=r.inherits,n=r.isArray;return i(e,t),e.prototype._init=function(){this._init$(void 0,1);var t=n(this._values);this._holes=t?this._values.length-this.length():0,!this._isResolved()&&t&&(this._howMany=Math.max(0,Math.min(this._howMany,this.length())),this.howMany()>this._canPossiblyFulfill()&&this._reject([]))},e.prototype.setUnwrap=function(){this._unwrap=!0},e.prototype.howMany=function(){return this._howMany},e.prototype.setHowMany=function(t){this._isResolved()||(this._howMany=t)},e.prototype._promiseFulfilled=function(t){this._isResolved()||(this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._fulfill(this._values[0]):this._fulfill(this._values)))},e.prototype._promiseRejected=function(t){this._isResolved()||(this._addRejected(t),this.howMany()>this._canPossiblyFulfill()&&(this._values.length===this.length()?this._reject([]):this._reject(this._values.slice(this.length()+this._holes))))},e.prototype._fulfilled=function(){return this._totalResolved},e.prototype._rejected=function(){return this._values.length-this.length()-this._holes},e.prototype._addRejected=function(t){this._values.push(t)},e.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},e.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},e}},{"./util.js":36}],35:[function(require,t){"use strict";t.exports=function(t){var e=require("./promise_inspection.js");t.prototype.inspect=function(){return new e(this)}}},{"./promise_inspection.js":20}],36:[function(require,t){"use strict";function e(t){"undefined"!=typeof console&&null!==console&&"function"==typeof console.warn&&console.warn("Bluebird: "+t)}function r(t,e,r){try{return t.call(e,r)}catch(i){return v.e=i,v}}function i(t,e,r,i){try{return t.call(e,r,i)}catch(n){return v.e=n,v}}function n(t,e,r){try{return t.apply(r,e)}catch(i){return v.e=i,v}}function s(t){return"string"==typeof t?t:""+t}function o(t){return null==t||t===!0||t===!1||"string"==typeof t||"number"==typeof t}function a(t){return!o(t)}function u(t){return o(t)?Error(s(t)):t}function l(t,e){var r,i=t.length,n=Array(i+1);for(r=0;i>r;++r)n[r]=t[r];return n[r]=e,n}function c(t,e,r){var i={value:r,configurable:!0,enumerable:!1,writable:!0};return Object.defineProperty(t,e,i),t}var f=require("./global.js");require("./assert.js");var h=function(){try{var t={};return Object.defineProperty(t,"f",{get:function(){return 3}}),3===t.f}catch(e){return!1}}(),p=function(t,e,r){try{return c(t,e,r),t}catch(i){for(var n={},s=Object.keys(t),o=0,a=s.length;a>o;++o)try{var u=s[o];n[u]=t[u]}catch(l){n[u]=l}return c(n,e,r),n}},_=function(){return"undefined"!=typeof window&&null!==window&&window.document!==undefined&&"undefined"!=typeof navigator&&null!==navigator&&"string"==typeof navigator.appName&&window===f?!1:!0}(),d=Array.isArray||function(t){return t instanceof Array},v={e:{}},y=function(t,e){function r(){this.constructor=t,this.constructor$=e;for(var r in e.prototype)i.call(e.prototype,r)&&"$"!==r.charAt(r.length-1)&&(this[r+"$"]=e.prototype[r])}var i={}.hasOwnProperty;return r.prototype=e.prototype,t.prototype=new r,t.prototype};t.exports={isArray:d,haveGetters:h,notEnumerableProp:c,isPrimitive:o,isObject:a,ensurePropertyExpansion:p,canEvaluate:_,deprecated:e,errorObj:v,tryCatch1:r,tryCatch2:i,tryCatchApply:n,inherits:y,withAppended:l,asString:s,maybeWrapAsError:u}},{"./assert.js":2,"./global.js":14}]},{},[4])(4)}),u._.Bluebird=l.exports,i();var j=/[^A-Z0-9\-\_]/gi,_=u._.Fiber.extend(function(){return{name:"AbstractComponent. Override me to improve debugging",id:"abstractcomponent",depends:[],elements:{},events:{},states:{},config:{},_init:null,_state:{},_eventEmitter:null,_observableEmitter:null,_isDestroyed:!1,init:function(t,e){var r,i;if(this._init=function(){},this.config={},this._eventEmitter=new u._.EventEmitter({wildcard:!1,newListener:!1,maxListeners:20}),this._observableEmitter=new u._.EventEmitter({wildcard:!1,newListener:!1,maxListeners:0}),this.elements.root="The root HTML node of this component (automatically generated)",this.elements=o(this.elements,!0),this.events=o(this.events,!0,!0),this.states=o(this.states,!0,!0),this.depends=o(this.depends),t&&this.attach(t),e)for(r in e)if(e.hasOwnProperty(r)&&"function"!=typeof this[r]&&0!==r.indexOf("_")&&"depends"!==r&&"events"!==r&&"config"!==r)if("elements"===r)for(i in e.elements)e.elements.hasOwnProperty(i)&&this.elements._.set(i,e.elements[i]);else this.config[r]=e[r]},assign:function(t,e){if(!this.elements._.exists(t))throw Error("Invalid element: "+t+". Only elements defined in this.elements:{} may be assigned");return this.elements._.set(t,e),this},resolve:function(t,e){if(!this.depends._.exists(t))throw Error("Invalid dependency: "+t+". Only dependencies defined in this.depends:[] may be resolved");return this.depends._.set(t,e),this},destroy:function(){return this._isDestroyed=!0,this.offAny(),this.elements().root.parentNode&&this.elements().root.parentNode.removeChild(this.elements().root),this.removeAllListeners(),null},on:function(t,e){return"*"===t?this._eventEmitter.onAny(e):this._eventEmitter.on(t,e),this},off:function(t,e){return"*"===t?e?this._eventEmitter.offAny(e):this._eventEmitter.offAll(t):this._eventEmitter.off(t,e),this},onOnce:function(t,e){return this._eventEmitter.onOnce(t,e),this},setMaxListeners:function(t){return this._eventEmitter.setMaxListeners(t),this},listeners:function(t){var e=this._eventEmitter.listenersAny(),r=this._eventEmitter.listeners(t);return r.concat(e)},trigger:function(){var t=[].slice.call(arguments,0),e=t[0];if(!this.events._.exists(e))throw Error("Invalid event: "+e+". Only events defined in this.events:{} may be triggered");
return this._eventEmitter.emit.apply(this._eventEmitter,t),this},bind:function(t,e,r){return"string"==typeof r?t.on(e,u.proxy(this[r],this)):t.on(e,r),this},unbind:function(t,e,r){return"string"==typeof r?t.off(e,this[r]):"function"==typeof r?t.off(e,r):t.off(e),this},wrap:function(t,e){var r=u.proxy(this[t],this),i=this;return this[t]=function(){var t=[].slice.call(arguments,0);return t.unshift(r),e.apply(i,t)},this},proxy:function(t,e){return function(){t.apply(e,arguments)}},attach:function(t){return this.assign("root",t),this},getRoot:function(){return this.elements().root},BEM:function(t,e){var r=this.id.replace(/[^A-Z0-9\-\_]/gi,"-");return t&&(r+="__"+t),e&&(r+="--"+e),r},addClass:function(t,e){var r=t.className;return n(t,e)||(r+=" "+e.replace(/[^A-Z0-9\-\_]/gi,"-"),r=r.replace(/^\s+|\s+$/g,"")),t.className=r,this},removeClass:function(t,e){var r=t.className;return r=r.replace(RegExp("(?:^|\\s)"+e.replace(j,"-")+"(?!\\S)","g"),""),r=r.replace(/^\s+|\s+$/g,""),t.className=r,this},when:function(){return u.when.apply(u,arguments)},whenAll:function(){return u.whenAll.apply(u,arguments)},load:function(t){this.elements().root&&(this.addClass(this.elements().root,this.BEM()),this.addClass(this.elements().root,this.BEM(this.elements.root)),this.addClass(this.elements().root,this.BEM(null,"loading")));for(var e,r=u.deferred(),i=this,n=[],s=this.depends._.raw(),o=this.depends(),a=0,l=s.length;l>a;a++)o[s[a]]||n.push(s[a]);return u.load.apply(u,n).then(function(r){var s,o,a=u.deferred();for(o=0,e=n.length;e>o;o++)i.depends._.set(n[o],r[o]);return s=u.when(i._init.call(i)),t&&(s=s.then(t)),s.then(function(){a.fulfill()},function(t){a.reject(t)}),a.promise}).then(function(){var t=i.elements._.raw();for(var e in t)t.hasOwnProperty(e)&&i.elements()[e]&&i.addClass(i.elements()[e],i.BEM(e));i.elements().root&&i.removeClass(i.elements().root,i.BEM(null,"loading")),r.fulfill()},function(t){i.elements().root&&(i.removeClass(i.elements().root,i.BEM(null,"loading")),i.addClass(i.elements().root,i.BEM(null,"failed"))),r.reject(t)}),r.promise},wire:function(t){function e(){return function(){}}function r(t,e){t.wrap("_init",function(r){r(),e.call(t)})}var i,n,s,o,a,u,l,c=/^[\[\]]/,f=/[\[\]]$/;if("function"==typeof t){if(t.__atomic)throw Error("Atomic Wirings must be configured (by invoking their function) and passing their return value into wire()");u={init:t}}else u=t;for(i in u)if(u.hasOwnProperty(i)){if(l=i.replace(c,"").replace(f,""),"_init"==l)throw Error('You cannot wire in "_init" as it\'s a reserved method. Please use "init" without the underscore.');if("events"!==i)if("elements"!==i)if("depends"!==i)"init"!==i&&"init"!==l?"function"!=typeof u[i]||(this[l]||(this[l]=e()),l!==i?0===i.indexOf("[")&&this.wrap(l,u[i]):this[l]=u[i]):"]init["===i?this._init=u[i]:r(this,u[i]);else for(o=0,a=u.depends.length;a>o;o++)this.depends._.add(u.depends[o]);else for(n in u.elements)this.elements[n]||this.elements._.add(n,u.elements[n]);else for(s in u.events)u.events.hasOwnProperty(s)&&this.properties._.add(s,u.events[s])}return this},state:function(t,e,undefined){var r,i=[].slice.call(arguments,0),n={},s=[],o=null;if(i[1]===undefined){if(i[0]===undefined){for(r in this._state)this._state.hasOwnProperty(r)&&(n[r]=this._state[r].value);return n}if("string"==typeof i[0])return this._state[i[0]].value}if("object"==typeof i[0])for(r in i[0])if(i[0].hasOwnProperty(r)){if(!this.states._.exists(r))throw Error("Invalid state: "+r+". Only states defined in this.states:{} may be set");i[1]?(this._state[r].rev++,this._state[r].lastValue=this._state[r].value,this._state[r].value=i[0][r]):this._state[r]===undefined&&(this._state[r]={rev:0,value:i[0][r],lastValue:undefined}),s.push(r)}if("string"==typeof i[0]){if(!this.states._.exists(i[0]))throw Error("Invalid state: "+i[0]+". Only states defined in this.states:{} may be set");this._state[i[0]]===undefined?this._state[i[0]]={rev:0,value:i[1],lastValue:undefined}:(this._state[i[0]].rev++,this._state[i[0]].lastValue=this._state[i[0]].value,this._state[i[0]].value=i[1]),s.push(i[0])}for(var a=0,u=s.length;u>a;a++)o=this._state[s[a]],this._observableEmitter.emit(s[a],o.value,o.lastValue,o.rev);return s.length>0?this.render():this},observe:function(t,e){return"*"===t?this._observableEmitter.onAny(e):this._observableEmitter.on(t,e),this},unobserve:function(t,e){return"*"===t?e?this._observableEmitter.offAny(e):this._observableEmitter.offAll(t):this._observableEmitter.off(t,e),this},render:function(){return this}}});_=_,u._.AbstractComponent=_;var g={Factory:function(t){var e={depends:!1,elements:!1,events:!1,init:!0,_init:!0,_eventEmitter:!0,_isDestroyed:!0},r=u._.AbstractComponent.extend(function(r){var i={};for(var n in t)t.hasOwnProperty(n)&&!e[n]&&(i[n]=t[n]);return i.init=function(){r.init.apply(this,arguments),"function"==typeof t.init&&(this._init=t.init)},i});return r}},m={Component:function(t){return g.Factory(t)},Wiring:function(t){return t.__atomic=!0,t}};m=m,g=g,u.augment(u,m),u.augment(u._,g);var b=t.Atomic,w=!1,E=!1,v={noConflict:function(){var e=t.Atomic;return t.Atomic=b,e},amdOptimized:function(){E=!0},load:function(){var t=u.deferred(),e=[].slice.call(arguments,0);"function"==typeof e[e.length-1]&&(t.promise.then(e[e.length-1]),e.pop()),1===e.length&&(e=e[0]),s(e)||(e=[e]);var r=null;return w?r=u.when(!0):(w=!0,r=u.when(u.loader.init()),r.then(function(){u.loader.register("Atomic",u),u.loader.register("Atomic/Component",u.Component)})),r.then(function(){return u.when(u.loader.load(e))}).then(function(e){return t.fulfill(e)},function(e){return t.reject(e)}),t.promise},proxy:function(t,e){return function(){return t.apply(e,arguments)}},throttle:function(t,e,r){var i,n,s,o=null,a=0,u=function(){a=new Date,o=null,s=t.apply(i,n)};return function(){var l=new Date;a||r!==!1||(a=l);var c=e-(l-a);return i=this,n=arguments,0>=c?(clearTimeout(o),o=null,a=l,s=t.apply(i,n)):o||(o=setTimeout(u,c)),s}},debounce:function(t,e,r){var i,n=null;return function(){var s=this,o=arguments,a=function(){n=null,r||(i=t.apply(s,o))},u=r&&!n;return clearTimeout(n),n=setTimeout(a,e),u&&(i=t.apply(s,o)),i}},expand:function(t){return function(e){var r,i=[];if("[object Array]"===Object.prototype.toString.call(e))i=e;else for(r in e)e.hasOwnProperty(r)&&i.push(e[r]);t.apply(t,i)}},keys:function(t){var e,r=[];for(e in t)t.hasOwnProperty(e)&&(r[r.length]=e);return r},deferred:function(t){var e=a();return t?(e.cast(t),undefined):e.pending()},when:function(t){return a().cast(t)},whenAll:function(t){return a().all(t)},error:function(t){var e="",r="";"object"==typeof t?(t.message?e=t.message:t.toString&&(e=""+t),t.stack?r=t.stack:t.stacktrace&&(r=t.stacktrace)):"string"==typeof t&&(e=t),console&&console.error&&console.error(e+"\n"+r)}};v.e=v.error,v=v,u.augment(u,v);var k=new u._.EventEmitter({wildcard:!0,newListener:!1,maxListeners:20}),y={on:function(t,e){return k.on(t,e),u},off:function(t,e){return k.off(t,e),u},onAny:function(t){return k.onAny(t),u},offAny:function(t){return k.offAny(t),u},onOnce:function(t,e){return k.onOnce(t,e),u},onMany:function(t,e,r){return k.onMany(t,e,r),u},offAll:function(t){return k.offAll(t),u},setMaxListeners:function(t){return k.setMaxListeners(t),u},listeners:function(t){var e=k.listenersAny(),r=k.listeners(t);return r.concat(e)},trigger:function(){var t=[].slice.call(arguments,0);return k.emit.apply(k,t),u}};y=y,u.augment(u.Events,y),u.version="0.0.9",t.Atomic=u;var A="function"==typeof h&&h.amd?h:u;A("Atomic",[],function(){return u}),A("Atomic/Component",[],function(){return u.Component}),A("Atomic/Wiring",[],function(){return u.Wiring})}})(this,function(){return define});